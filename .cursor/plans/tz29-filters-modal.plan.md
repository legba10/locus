# ТЗ-29 — Полная переработка фильтров поиска (mobile, логика + UI)

**Статус:** выполнен  
**Цель:** единый современный фильтр-модал, один источник истины (FiltersModal).

## Сделано

### 1. Единый FiltersModal
- **Удалён** отдельный сценарий с MobileFilters на странице поиска. Используется только **FiltersModal** для mobile и desktop.
- Открытие как **bottom sheet**, высота **90vh**, скролл внутри.
- Закрытие: крестик, свайп вниз (индикатор сверху), кнопка «Применить».
- Фон и стиль: `bg-[var(--bg-main)]`, единые переменные.

### 2. Порядок блоков (строго по ТЗ)
1. **Город** — строка «{город}   Изменить», по клику открывается CitySelect, кнопка «Готово».
2. **Бюджет** — двойной слайдер + поля «От» / «До» (компонент BudgetRange).
3. **Срок аренды** — кнопки: Любой, Посуточно, Долгосрочно (один выбор).
4. **Тип жилья** — чекбоксы (мультивыбор): Квартира, Дом, Комната, Студия.
5. **Комнаты** — кнопки: 1, 2, 3, 4+.
6. **Радиус** — слайдер 1–20 км, подпись «Радиус от центра»; в store хранятся метры (km × 1000).
7. **Доп. фильтры** — свернутый блок; по клику раскрытие: Балкон, Wi-Fi, Парковка, Можно с животными, Кондиционер (локальное состояние, без сохранения в store).
8. **Режим поиска** — блок с переключателем [Умный подбор] / [Ручной поиск] (AIModeSwitch).
9. **Нижняя панель** — фикс: «Сбросить» (вторичная) и «Применить» (крупная, фирменная), с учётом safe-area.

### 3. Отступы
- Между блоками: **16px** (`space-y-4`).
- Между элементами внутри блоков: 8–12px (gap-2, py-2.5, mb-2).

### 4. Логика
- При открытии модала подтягиваются текущие значения из **useFilterStore**.
- **Применить** — закрывает модал, вызывается `onApply()` (обновление поиска на странице).
- **Сбросить** — `reset()` в store + сброс локальных доп. фильтров.

### 5. Chips после применения (TZ-29 п.14)
- Компонент **ActiveFilterChips**: показывает активные фильтры как chips (Москва ×, 2 комнаты ×, до 80k ×).
- Размещён на странице поиска над результатами; по × сбрасывается соответствующий фильтр.

### 6. Интеграция с AI (TZ-29 п.15)
- При выбранном «Умный подбор» после применения поиск идёт с учётом AI (существующая логика SearchPageV4).
- Если результатов ещё нет — показывается блок «Подбираем варианты под вас…».
- Если есть результаты — блок «Подобрано AI» с пояснением.

### 7. Удалено / не используется
- На странице поиска **не используется** MobileFilters; вызов только **FiltersModal**.
- Сохранён один источник истины: **FiltersModal.tsx**.

### 8. Проверки
- Открытие фильтров, выбор параметров, Применить, обновление результатов — через store и URL.
- Режим AI (Умный подбор) и ручной поиск работают через существующий store и эффекты.
- Сброс очищает все поля store (reset).

## Файлы

- `components/filters/FiltersModal.tsx` — переписан под ТЗ-29.
- `components/filters/ActiveFilterChips.tsx` — новый компонент chips.
- `app/listings/SearchPageV4.tsx` — только FiltersModal, добавлены ActiveFilterChips и блок «Подбираем варианты под вас».
- `components/filters/index.ts` — экспорт ActiveFilterChips.
