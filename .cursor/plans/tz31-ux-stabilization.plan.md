# ТЗ 31 — Полная UX-стабилизация перед финальным пушем

## Цель
Единая логика навигации, без дублей, без 404, консистентный UI.

## Статус: в работе

### 1. Единая навигационная архитектура ✅

- **Header (ТЗ-31 п.1.2):** только логотип, поиск, колокольчик, аватар. Кнопки «Сдать жильё» и «Сообщения» убраны из header (есть в сайдбаре и нижнем меню).
- **Desktop сайдбар (AppSidebarTZ14):** ссылки приведены к /profile и /profile/listings/create; Профиль и Добавить ведут в кабинет.
- **Нижнее меню (BottomNavGlobal):** 5 пунктов без изменений; «Добавить» → /profile/listings/create.
- **Бургер:** не используется в корневом layout (используется Header из components/layout).

### 2. Маршруты ✅

- Редиректы в `next.config.js`:
  - `/add` → `/profile/listings/create`
  - `/search` → `/listings`
  - `/bookings` → `/profile/bookings`
  - `/dashboard/*` → соответствующие `/profile/*`
- Проверяемые маршруты: `/profile`, `/profile/listings`, `/profile/finance`, `/profile/promo`, `/profile/settings`, `/messages`, `/listings` — страницы есть или редирект корректен.

### 3. Поиск и 400 от /api/search

- При пустых фильтрах запрос идёт на `/api/listings?limit=24` вместо `/api/search?`, чтобы снизить 400 от бэкенда.
- Параметр `sort=popular` не передаётся в запрос (частая причина 400).
- Для поиска задано `retry: false`, чтобы не заспамить консоль при ошибках.
- Если 400 сохраняются при фильтрах — дорабатывать валидацию на бэкенде.

### 4. Визуал и поведение

- Header: `sticky top-0`, фиксированная высота.
- Нижняя панель: `fixed bottom-0`, только на mobile (`md:hidden`).
- Радиусы 16px и отступы 24px заданы в ТЗ-30 для карточек профиля.

### 5. Что проверить вручную

- Роли: гость — нет профиля/финансов/продвижения; авторизованный — профиль, сообщения, добавление; админ — админка без дублей профиля.
- Страница объявления: фото, описание, кнопка бронирования, карта по кнопке, AI-метрики.
- Фильтры и поиск: открытие, применение, без залипания.
- Тёмная/светлая тема: читаемость, без засветов и инверсий.
- Удалить любые оставшиеся debug-тексты и временные кнопки (например, «→ Выйти» / «Поиск» в углу, если появятся).

### Файлы изменений (ТЗ-31)

- `frontend/components/layout/Header.tsx` — комментарии, без дублей CTA в header.
- `frontend/components/layout/AppSidebarTZ14.tsx` — ссылки на /profile, /profile/listings/create.
- `frontend/next.config.js` — редиректы /add, /search.
- `frontend/app/listings/SearchPageV4.tsx` — fallback на /api/listings при пустых фильтрах, без sort=popular, retry: false.
- `frontend/components/search/SearchOverlay.tsx` — при только limit=24 запрос на /api/listings, retry: false.
