# LOCUS — Core System V1

**Цель:** Рабочая платформа: объявления, модерация, чат 1-на-1, тест-оплаты, уведомления, роли, админ-панель.  
**Принцип:** Не ломать, работать поверх текущей архитектуры.

---

## 1. Роли

| Роль | Описание |
|------|----------|
| ROOT | email legba086@mail.ru, всегда админ, нельзя понизить |
| ADMIN | назначает роли, модерация, пуш, аналитика |
| MANAGER | проверка объявлений, approve/reject |
| MODERATOR | чат поддержки, помощь в редактировании объявлений |
| USER | обычный пользователь |

**Статус:** Добавить ROOT и MODERATOR в enum; ROOT по email; set-role только для ROOT.

---

## 2. Модерация объявлений

- Статусы: draft → pending → approved / rejected.
- При создании: статус **pending** (не публикуется сразу).
- Админка: `/admin/moderation` — список pending, карточка (фото, описание, пользователь), кнопки Одобрить / Отклонить.
- При отклонении: причина в `reject_reason` (в схеме уже есть `moderationComment`), уведомление пользователю, можно редактировать.

**Статус:** Бэкенд уже создаёт с PENDING_REVIEW; approve/reject есть. Нужно: маршрут `/admin/moderation`, при необходимости алиас поля.

---

## 3. Чат 1 на 1 (приоритет 1)

- Кнопка «Написать» в объявлении → чат автор + покупатель.
- Страницы: `/messages`, `/chat/:id`.
- Функции: отправка, список чатов, непрочитанные, realtime.
- Модератор: доступ в support-чат.

**Статус:** Модели Conversation + Message, API, фронт /messages и /chat/:id, кнопка в карточке объявления.

---

## 4. Бронирование

- Кнопка «Забронировать» → выбор дат → создание брони → переход к оплате.
- Статусы: pending, confirmed, cancelled (есть в схеме).

**Статус:** Booking есть; фронт: кнопка, выбор дат, создание, редирект на оплату.

---

## 5. Платежи (тест) (приоритет 4)

- ЮKassa test mode.
- Flow: создать payment → payment_url → редирект → webhook → confirmed.

**Статус:** Модуль payments, модель Payment, webhook.

---

## 6. Уведомления (приоритет 2)

- Типы: новое сообщение, новая бронь, одобрено, отклонено, админ пуш.
- Где: иконка колокольчика в хедере, список.
- Звук при новом сообщении и брони.
- Web Push для админа (отправка всем) и входящие.

**Статус:** Типы и сервис есть; доработать UI, звук, Web Push, админ-пуш.

---

## 7. Admin Push

- Раздел «Уведомления» в админке: форма (текст, ссылка), отправка всем.

**Статус:** В рамках админ-панели.

---

## 8. Страница объявления

- Проверить: владелец, рейтинг, «Написать», «Забронировать», sticky-кнопки, галерея.

---

## 9. Админ-панель (приоритет 5)

Разделы: Dashboard, Пользователи, Модерация, Брони, Push, Чаты.

---

## 10. Порядок реализации

1. Чат  
2. Уведомления  
3. Модерация (привести в соответствие)  
4. Платежи тест  
5. Админ-панель  

---

## Чек-лист по задачам

| # | Задача | Статус |
|---|--------|--------|
| 1 | Роли ROOT/MODERATOR, ROOT по email | done |
| 2 | Чат: модели, API, /messages, /chat/:id, кнопка «Написать» | done |
| 3 | Уведомления: колокольчик, список, звук; админ-пуш | done (пуш в админке) |
| 4 | Модерация: /admin/moderation | done |
| 5 | Платежи: ЮKassa test, webhook | pending |
| 6 | Админ: Dashboard, Users, Moderation, Bookings, Push, Chats | pending |
| 7 | Страница объявления: владелец, рейтинг, кнопки, галерея | pending |
