# ТЗ-11: Сообщения и чат — стабилизация UX

## Статус: выполнен

## Сделано

### 1. Структура
- **ПК:** 2 колонки — список диалогов (320px) | окно переписки. Высота `calc(100vh - header)`, скролл только внутри колонок.
- **Мобилка:** список → тап по чату → полноэкранный чат → кнопка «Назад».

### 2. Фиксация высоты
- Страница сообщений: контейнер `position: fixed`, `top: var(--header-height)`, `bottom: 0`, `overflow: hidden`. Страница не скроллится.
- Страница чата `/chat/[id]`: контейнер `position: fixed` под шапкой, внутри `ChatPanel` на всю высоту.

### 3. Автоскролл
- Скролл вниз только при первой загрузке диалога и после отправки сообщения.
- При опросе (polling) новых сообщений автоскролл не вызывается — не дергается при листании вверх.

### 4. Список диалогов
- Аватар, имя, последнее сообщение, время. Бейдж непрочитанных (unreadCount). Высота колонки фиксирована, скролл внутри.

### 5. Открытие диалога
- Через `router.replace('/messages?chat=id')` без перезагрузки. На ПК чат показывается во второй колонке, на мобиле — полноэкранно.

### 6. Поле ввода
- В `ChatPanel`: footer с `flex-shrink: 0`, фиксирован внизу, не прыгает.

### 7. Skeleton
- В `ChatPanel` при загрузке сообщений показываются скелетоны пузырей (4 блока).

### 8. Тёмная тема
- Фон, границы и текст через `var(--card-bg)`, `var(--border)`, `var(--text-main)`, `var(--bg-secondary)` для пузырей и списка.

### 9. Кнопка «Назад» (мобилка)
- В шапке `ChatPanel` при переданном `onBack` (на странице сообщений и на `/chat/[id]`).

### 10. Переходы
- Список диалогов — кнопки с `openChat(id)` → `router.replace('/messages?chat=id')`. Существующий диалог открывается по id.

## Файлы
- `frontend/components/chat/ChatPanel.tsx` — общий компонент чата (скролл, автоскролл по правилам, скелетон, тема).
- `frontend/app/chat/[id]/page.tsx` — обёртка с фиксированным контейнером и `ChatPanel`.
- `frontend/app/messages/page.tsx` — две колонки, `?chat=`, мобильный список/чат и назад.
- `frontend/styles/messages-tz11.css` — переменная `--header-height`, тёмная тема, фиксация футера.
- `frontend/styles/globals.css` — импорт `messages-tz11.css`.

## Коммит
fix: messages layout + scroll stability + mobile chat UX
