# План: ТЗ №4 — Переработка блока загрузки фото при размещении объявления

## Цель

Нормальная система загрузки фото: разные режимы, подписи к фото, обложка, сортировка, минимум 5 фото (комната + санузел), удобный UX.

## Выполнено

### 1. Два режима (StartStep)
- **Быстро через фото** — после загрузки показывается «AI анализирует фото...» (mock 1.5 с), затем переход к шагу 2. Режим `listingMode === 'quick'`.
- **Создать вручную** — переход к шагу 2 без AI. Режим `listingMode === 'manual'`.
- Подписи: «AI заполнит объявление» / «Поля заполняете сами».

### 2. Модель данных
- **photo-upload-types.ts**: `ListingPhotoTag` = "room" | "kitchen" | "bathroom" | "balcony" | "other".
- В мастере: `NewPhoto` с полем `tag: ListingPhotoTag`, `ExistingPhoto` с опциональным `tag`.
- Обложка = первый по счёту (coverPhotoIndex в объединённом списке).

### 3. Компоненты
- **PhotoTagSelect.tsx** — dropdown под фото: Обложка, Комната, Кухня, Санузел, Балкон, Другое. Выбор «Обложка» вызывает onSetCover.
- **PhotoCard.tsx** — квадратная карточка, радиус 12, hover overlay: удалить, «Сделать обложкой», бейдж «Обложка», блок с PhotoTagSelect.
- **PhotoUploader.tsx** — сетка 3 колонки, gap 8px, drag-and-drop по индексам, кнопка «+ добавить фото», отображение ошибки валидации.

### 4. Валидация
- Минимум 5 фото.
- Обязательные теги: хотя бы одно фото с тегом «room» и одно с «bathroom» (REQUIRED_TAGS).
- Сообщение: «Добавьте минимум 5 фото (комната и санузел обязательны)».

### 5. Обложка
- Выбор «Обложка» в селекторе или кнопка «Сделать обложкой» задаёт coverPhotoIndex.
- При отправке фото загружаются в порядке: сначала обложка (по coverPhotoIndex), затем остальные.

### 6. Перетаскивание
- Native HTML5 drag-and-drop в PhotoUploader: перестановка только среди новых фото (индексы в объединённом списке). При перетаскивании пересчитывается coverPhotoIndex.

### 7. Удаление
- При удалении нового или существующего фото пересчитывается coverPhotoIndex (чтобы не указывал на удалённый элемент).

### 8. AI-режим (заготовка)
- При переходе «Далее» с шага 1 в режиме «quick» показывается overlay «AI анализирует фото...» на 1.5 с, затем переход на шаг 2. Без реального AI/бэкенда.

## Файлы

- `components/listing/photo-upload-types.ts` — типы и константы.
- `components/listing/PhotoTagSelect.tsx` — селектор тега.
- `components/listing/PhotoCard.tsx` — карточка фото.
- `components/listing/PhotoUploader.tsx` — сетка и логика загрузки.
- `domains/listings/ListingWizard.tsx` — интеграция: режимы, photoItems, валидация тегов, порядок загрузки с обложкой первой.

## Критерии готовности

- [x] Можно менять порядок (drag в пределах новых фото).
- [x] Можно ставить теги (dropdown под каждым фото).
- [x] Можно менять обложку (селектор «Обложка» / кнопка «Сделать обложкой»).
- [x] Есть минимум 5 фото и обязательные теги (комната, санузел).
- [x] Режимы разные (быстро через фото vs вручную, mock AI).
- [ ] Удобно на мобиле (проверка вручную).

## Не делали

- Сложный AI и изменения бэкенда — только UI и клиентская логика.
