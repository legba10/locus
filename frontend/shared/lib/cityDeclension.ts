/**
 * Склонение названия города в предложный падеж (где? → в Москве, в Сургуте).
 * Одна функция для всего приложения — без дублирования и ручного «в Москве».
 */

const LOCATIVE_MAP: Record<string, string> = {
  Москва: "в Москве",
  "Санкт-Петербург": "в Санкт-Петербурге",
  СПб: "в Санкт-Петербурге",
  Новосибирск: "в Новосибирске",
  Екатеринбург: "в Екатеринбурге",
  "Нижний Новгород": "в Нижнем Новгороде",
  Казань: "в Казани",
  Челябинск: "в Челябинске",
  Омск: "в Омске",
  Самара: "в Самаре",
  "Ростов-на-Дону": "в Ростове-на-Дону",
  Уфа: "в Уфе",
  Красноярск: "в Красноярске",
  Воронеж: "в Воронеже",
  Пермь: "в Перми",
  Волгоград: "в Волгограде",
  Краснодар: "в Краснодаре",
  Саратов: "в Саратове",
  Тюмень: "в Тюмени",
  Сургут: "в Сургуте",
  Тольятти: "в Тольятти",
  Ижевск: "в Ижевске",
  Барнаул: "в Барнауле",
  Ульяновск: "в Ульяновске",
  Иркутск: "в Иркутске",
  Владивосток: "во Владивостоке",
  Ярославль: "в Ярославле",
  Хабаровск: "в Хабаровске",
  Махачкала: "в Махачкале",
  Томск: "в Томске",
  Оренбург: "в Оренбурге",
  Кемерово: "в Кемерово",
  Новокузнецк: "в Новокузнецке",
  Рязань: "в Рязани",
  "Набережные Челны": "в Набережных Челнах",
  Астрахань: "в Астрахани",
  Пенза: "в Пензе",
  Липецк: "в Липецке",
  Киров: "в Кирове",
  Чебоксары: "в Чебоксарах",
  Калининград: "в Калининграде",
  Тула: "в Туле",
  Ставрополь: "в Ставрополе",
  Курск: "в Курске",
  "Улан-Удэ": "в Улан-Удэ",
  Тверь: "в Твери",
  Магнитогорск: "в Магнитогорске",
  Сочи: "в Сочи",
  Белгород: "в Белгороде",
  Архангельск: "в Архангельске",
  Владимир: "во Владимире",
  Чита: "в Чите",
  Калуга: "в Калуге",
  Иваново: "в Иваново",
  Брянск: "в Брянске",
  Смоленск: "в Смоленске",
  Вологда: "в Вологде",
  Орёл: "в Орле",
  Тамбов: "в Тамбове",
  Петрозаводск: "в Петрозаводске",
  Мурманск: "в Мурманске",
  Севастополь: "в Севастополе",
  Симферополь: "в Симферополе",
  Якутск: "в Якутске",
  "Южно-Сахалинск": "в Южно-Сахалинске",
  Нижневартовск: "в Нижневартовске",
  Нефтеюганск: "в Нефтеюганске",
  Когалым: "в Когалыме",
  Нягань: "в Нягани",
  "Пыть-Ях": "в Пыть-Яхе",
  "Ханты-Мансийск": "в Ханты-Мансийске",
  Урай: "в Урае",
  Тобольск: "в Тобольске",
  "Новый Уренгой": "в Новом Уренгое",
  Ноябрьск: "в Ноябрьске",
  Салехард: "в Салехарде",
  Надым: "в Надыме",
  Великий Новгород: "в Великом Новгороде",
  Нижний Тагил: "в Нижнем Тагиле",
  Грозный: "в Грозном",
  Магадан: "в Магадане",
  Владикавказ: "во Владикавказе",
  Нальчик: "в Нальчике",
  Майкоп: "в Майкопе",
  Элиста: "в Элисте",
};

/**
 * Возвращает город в предложном падеже с предлогом: «в Москве», «в Сургуте».
 * Для пустой строки возвращает ''.
 */
export function cityIn(city: string): string {
  const trimmed = city?.trim() || "";
  if (!trimmed) return "";

  const fromMap = LOCATIVE_MAP[trimmed] ?? LOCATIVE_MAP[trimmed.replace(/\s+/g, " ")];
  if (fromMap) return fromMap;

  // Fallback по окончаниям
  if (trimmed.endsWith("а")) return `в ${trimmed.slice(0, -1)}е`;
  if (trimmed.endsWith("ск")) return `в ${trimmed.slice(0, -2)}ске`;
  if (trimmed.endsWith("ь")) return `в ${trimmed.slice(0, -1)}и`;
  if (trimmed.endsWith("бург")) return `в ${trimmed.slice(0, -4)}бурге`;
  if (trimmed.endsWith("град")) return `в ${trimmed.slice(0, -4)}граде`;
  if (trimmed.endsWith("ов") || trimmed.endsWith("ев")) return `в ${trimmed}е`;
  if (trimmed.endsWith("ин")) return `в ${trimmed.slice(0, -2)}ине`;
  if (trimmed.endsWith("о")) return `в ${trimmed}`;
  if (trimmed.endsWith("ы") || trimmed.endsWith("и")) return `в ${trimmed}`;

  return `в ${trimmed}`;
}
